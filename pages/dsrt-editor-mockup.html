<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DSRT Editor — Mockup Responsif</title>
<style>
  :root{
    --bg:#0c0d10; --panel:#12131a; --muted:#1a1c24; --line:#212330;
    --text:#e9eef7; --sub:#9aa3b2; --brand:#66e0ff; --accent:#ffd166;
    --premium:#b084ff; --ok:#7cf29c; --warn:#ffad66;
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b0c11, #0b0c11 60%, #0c0d12);
       color:var(--text);font:14px/1.25 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;}
  .app{height:100%;display:grid;grid-template-rows:auto 1fr auto}
  /* HEADER */
  header{position:sticky;top:0;z-index:30;background:rgba(12,13,18,.8);
    backdrop-filter:saturate(140%) blur(10px); border-bottom:1px solid var(--line)}
  .hbar{height:56px;display:flex;align-items:center;gap:.5rem;padding:0 .75rem}
  .sp{flex:1}
  .btn{display:inline-flex;align-items:center;gap:.5rem;border:1px solid var(--line);
    background:var(--muted);color:var(--text);height:36px;padding:0 .8rem;border-radius:12px;
    cursor:pointer;user-select:none}
  .btn:is(:hover,:focus-visible){outline:none;border-color:#2a2d3d;background:#171923}
  .ghost{background:transparent}
  .brand{border-color:transparent;background:linear-gradient(180deg,#6af,#4de);
    color:#081018; font-weight:700}
  .icon{width:18px;height:18px;display:inline-block}
  .title{font-weight:700;letter-spacing:.2px}
  input[type=file]{display:none}
  /* LAYOUT */
  .main{display:grid;grid-template-columns: 1fr;min-height:0}
  /* Desktop: sidebar kiri */
  @media (min-width: 980px){
    .main{grid-template-columns: 88px 1fr 320px}
  }
  /* SIDEBAR kategori (desktop) */
  .sideL{display:none}
  @media (min-width:980px){
    .sideL{display:flex;flex-direction:column;gap:.5rem;padding:.75rem;border-right:1px solid var(--line);
      background:var(--panel)}
  }
  .tabIcon{width:64px;height:64px;border-radius:16px;border:1px solid var(--line);
    background:linear-gradient(180deg,#0f1118,#0c0d12);display:grid;place-items:center;
    cursor:pointer}
  .tabIcon.active{border-color:var(--brand);box-shadow:0 0 0 2px rgba(102,224,255,.15) inset}
  .tabIcon span{font-size:10px;color:var(--sub);margin-top:6px;display:block;text-align:center}
  /* STAGE */
  .stageWrap{position:relative;min-height:0;background:var(--bg)}
  .stage{position:absolute;inset:0;padding:14px}
  .board{position:relative;height:100%;border:1px solid var(--line);border-radius:var(--radius);
    background:
      linear-gradient(45deg,#171922 25%,transparent 25%),
      linear-gradient(-45deg,#171922 25%,transparent 25%),
      linear-gradient(45deg,transparent 75%,#171922 75%),
      linear-gradient(-45deg,transparent 75%,#171922 75%);
    background-size:20px 20px;
    background-position:0 0,0 10px,10px -10px,-10px 0;
    overflow:hidden}
  .board canvas,.placeholder{position:absolute;inset:0}
  .placeholder{display:grid;place-items:center;color:var(--sub)}
  .placeholder .card{background:#0e1016;border:1px dashed var(--line);border-radius:14px;
    padding:14px 16px;text-align:center}
  /* PROPERTY PANEL (desktop kanan / mobile slide) */
  .sideR{display:none}
  @media (min-width:980px){
    .sideR{display:flex;flex-direction:column;border-left:1px solid var(--line);
      background:var(--panel);padding:12px;gap:12px}
  }
  .panel{background:var(--muted);border:1px solid var(--line);border-radius:14px;padding:12px}
  .panTitle{font-weight:700;margin:0 0 8px}
  .grid{display:grid;gap:8px}
  .grid.cols-4{grid-template-columns:repeat(4,1fr)}
  .grid.cols-3{grid-template-columns:repeat(3,1fr)}
  .tile{height:76px;border:1px solid var(--line);border-radius:12px;background:#0f1118;
    padding:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;
    gap:6px;cursor:pointer}
  .tile:hover{border-color:#2b2e40;background:#121524}
  .tl{font-size:11px;color:#c9d1e1;text-align:center}
  .gem{position:absolute;top:6px;right:6px;width:14px;height:14px;border-radius:4px;
    background:radial-gradient(circle at 30% 30%, #fff 0 20%, transparent 25%),
               linear-gradient(140deg,#c9a7ff,#8a6bff);
    box-shadow:0 0 0 1px rgba(186,150,255,.5)}
  .tile.wrap{position:relative}
  /* TABS (Basic/Medium/Pro) */
  .seg{display:flex;background:#0e1016;border:1px solid var(--line);border-radius:12px;padding:4px;gap:4px}
  .seg button{flex:1;height:32px;border:0;border-radius:8px;background:transparent;color:var(--sub);cursor:pointer}
  .seg button.active{background:#eaf3ff;color:#0a0f16;font-weight:700}
  /* BOTTOM NAV (mobile) */
  .bottom{position:sticky;bottom:0;z-index:35;border-top:1px solid var(--line);
    background:rgba(12,13,18,.92);backdrop-filter:saturate(140%) blur(10px)}
  .tabsRow{display:flex;gap:8px;padding:.5rem;overflow:auto}
  .pill{flex:1;min-width:100px;display:flex;align-items:center;justify-content:center;gap:.5rem;
    height:40px;border-radius:12px;border:1px solid var(--line);background:var(--muted)}
  .pill.active{border-color:var(--brand);box-shadow:0 0 0 2px rgba(102,224,255,.15) inset}
  /* MOBILE SLIDE-UP SUBPANEL */
  .drawer{position:fixed;left:0;right:0;bottom:0;transform:translateY(100%);
    transition:.28s ease;z-index:50}
  .drawer.show{transform:translateY(0)}
  .sheet{border-top-left-radius:18px;border-top-right-radius:18px;
    background:var(--panel);border-top:1px solid var(--line);padding:12px}
  .drag{margin:4px auto 12px;width:40px;height:4px;border-radius:2px;background:#2a2d3d}
  @media (min-width:980px){ .bottom,.drawer{display:none} }
  /* COLORED ROTATE ICON */
  .icon-rotate path.grad{stroke:url(#rotG)}
  /* small helpers */
  .muted{color:var(--sub)}
</style>
</head>
<body>
<div class="app" id="app">
  <!-- HEADER -->
  <header>
    <div class="hbar">
      <button class="btn ghost" id="btnBack" title="Kembali">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" stroke-linecap="round" d="M15 18l-6-6 6-6"/></svg>
        <span class="title">Back</span>
      </button>
      <div class="sp"></div>
      <label class="btn" title="Open">
        <input id="file" type="file" accept="image/*">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 7h5l2 2h11v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"/></svg>
        <span class="hide-sm">Open</span>
      </label>
      <button class="btn" id="btnSave" title="Save (mock)">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M17 16a2 2 0 0 0 2-2V7l-3-3H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h5"/><path stroke-width="2" d="M7 7h8v4H7z"/></svg>
        <span>Save</span>
      </button>
      <button class="btn ghost" id="btnUndo" title="Undo">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M9 14l-4-4 4-4"/><path stroke-width="2" d="M20 20v-5a7 7 0 0 0-7-7H5"/></svg>
      </button>
      <button class="btn ghost" id="btnRedo" title="Redo">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M15 6l4 4-4 4"/><path stroke-width="2" d="M4 4v5a7 7 0 0 0 7 7h8"/></svg>
      </button>
    </div>
  </header>

  <!-- MAIN -->
  <div class="main">
    <!-- LEFT SIDEBAR: kategori (desktop) -->
    <aside class="sideL" id="navDesk">
      <div class="tabIcon" data-tab="manual" title="Manual Edit">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M7 8h3v3H7zM14 3l7 7-2 2-7-7zM3 14l7 7 2-2-7-7z"/></svg>
      </div>
      <div class="tabIcon" data-tab="filter" title="Filter">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 21l18-18M14 7l3 3M7 14l3 3"/></svg>
      </div>
      <div class="tabIcon" data-tab="bg" title="Hapus BG">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M9.6 8.4L20 3l-5.4 10.4M12 12L4 20m6-6l8 8M4 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm0 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/></svg>
      </div>
      <div class="tabIcon" data-tab="text" title="Teks">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 6h16M10 6v12m4-12v12"/></svg>
      </div>
      <div class="tabIcon" data-tab="more" title="Lainnya">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>
      </div>
    </aside>

    <!-- STAGE -->
    <section class="stageWrap">
      <div class="stage">
        <div class="board" id="board">
          <canvas id="cv"></canvas>
          <div class="placeholder" id="ph">
            <div class="card">
              <div style="font-weight:700;margin-bottom:6px">Belum ada gambar</div>
              <div class="muted">Tap <b>Open</b> untuk memulai. Ini mockup (tanpa logika edit).</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT: Properties (live context — desktop) -->
    <aside class="sideR">
      <div class="panel">
        <h4 class="panTitle">Properti / Opsi</h4>
        <div class="muted" id="propText">Pilih tool untuk melihat opsi.</div>
      </div>

      <!-- SUBPANEL CONTENT (sama dengan mobile drawer) -->
      <div class="panel" id="subpanelDesk">
        <!-- diisi via JS -->
      </div>
    </aside>
  </div>

  <!-- BOTTOM NAV: kategori (mobile) -->
  <div class="bottom" id="navMobile">
    <div class="tabsRow">
      <button class="pill" data-tab="manual">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M7 8h3v3H7zM14 3l7 7-2 2-7-7zM3 14l7 7 2-2-7-7z"/></svg>
        <span>Manual</span>
      </button>
      <button class="pill" data-tab="filter">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 21l18-18M14 7l3 3M7 14l3 3"/></svg>
        <span>Filter</span>
      </button>
      <button class="pill" data-tab="bg">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M9.6 8.4L20 3l-5.4 10.4M12 12L4 20m6-6l8 8M4 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm0 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/></svg>
        <span>Hapus BG</span>
      </button>
      <button class="pill" data-tab="text">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 6h16M10 6v12m4-12v12"/></svg>
        <span>Teks</span>
      </button>
      <button class="pill" data-tab="more">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>
        <span>Lainnya</span>
      </button>
    </div>
  </div>

  <!-- MOBILE DRAWER (subpanel) -->
  <div class="drawer" id="drawer">
    <div class="sheet">
      <div class="drag"></div>
      <div id="subpanelMobile"><!-- diisi via JS --></div>
    </div>
  </div>
</div>

<!-- SVG defs for colored rotate -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="rotG" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#6af"/>
      <stop offset="100%" stop-color="#4de"/>
    </linearGradient>
  </defs>
</svg>

<script>
/* ---------- DATA: daftar fitur (slot penuh) ---------- */
const TOOLS = {
  manual: {
    tabs: ["basic","medium","pro"],
    label: {basic:"Basic", medium:"Medium", pro:"Professional"},
    basic: [
      {k:"crop",   t:"Crop"},
      {k:"rotate", t:"Rotate", iconColor:true},
      {k:"flip",   t:"Flip"},
      {k:"resize", t:"Resize"},
      {k:"adjust", t:"Adjust"},
      {k:"auto",   t:"Auto Enhance"},
      {k:"sharpen",t:"Sharpen"},
      {k:"clarity",t:"Clarity"},
      {k:"wb",     t:"White Balance"},
      {k:"redeye", t:"Red Eye"},
      {k:"vign",   t:"Vignette"},
      {k:"grain",  t:"Film Grain"}
    ],
    medium: [
      {k:"heal",   t:"Spot Healing"},
      {k:"clone",  t:"Clone Stamp"},
      {k:"dodge",  t:"Dodge / Burn"},
      {k:"noise",  t:"Denoise"},
      {k:"balance",t:"Color Balance"},
      {k:"curve",  t:"Curves"},
      {k:"levels", t:"Levels"},
      {k:"hsl",    t:"HSL"},
      {k:"lens",   t:"Lens Fix"},
      {k:"persp",  t:"Perspective"},
      {k:"tilt",   t:"Tilt-Shift"},
      {k:"split",  t:"Split Tone"}
    ],
    pro: [
      {k:"inpaint",  t:"Inpaint AI", pro:true},
      {k:"facerep",  t:"Face Restore", pro:true},
      {k:"superres", t:"Super Resolution", pro:true},
      {k:"deblur",   t:"DeBlur AI", pro:true},
      {k:"colorize", t:"Colorize AI", pro:true},
      {k:"bgbuild",  t:"BG Rebuild", pro:true},
      {k:"relight",  t:"Re-Light AI", pro:true},
      {k:"style",    t:"Style Transfer", pro:true},
      {k:"hdrmerge", t:"HDR Merge", pro:true},
      {k:"raw",      t:"RAW Develop", pro:true},
      {k:"matte",    t:"Matting Pro", pro:true},
      {k:"upscale",  t:"4x Upscale", pro:true}
    ]
  },
  filter: {
    presets: [
      "Original","BW","Mono","Noir","Sepia","Vintage","Warm","Cool",
      "Cinema","Vibrant","Matte","Pastel","Lomo","Fade","Dramatic","Pop",
      "Teal&Orange","Azul","Emerald","Sunset","Portrait","Landscape","Night"
    ]
  },
  bg: {
    items: [
      {k:"bgremove", t:"Remove BG"},
      {k:"bgreplace",t:"Replace BG"},
      {k:"bgblur",   t:"Blur BG"},
      {k:"bgradient",t:"Gradient BG"},
      {k:"bgsolid",  t:"Solid BG"},
      {k:"bgai",     t:"BG AI Scene", pro:true}
    ]
  },
  text: {
    items: [
      {k:"tadd", t:"Tambah Teks"},
      {k:"tfont",t:"Font"},
      {k:"tstyle",t:"Style"},
      {k:"tshadow",t:"Shadow"},
      {k:"tstroke",t:"Stroke"},
      {k:"tcurve", t:"Text Curve"},
      {k:"tshape", t:"Text Shape"},
      {k:"twarp",  t:"Warp"},
      {k:"tgrad",  t:"Gradient"},
      {k:"tmask",  t:"Mask"}
    ]
  },
  more: {
    items: [
      {k:"frame", t:"Frame"},
      {k:"sticker", t:"Sticker"},
      {k:"flare", t:"Lens Flare"},
      {k:"watermark", t:"Watermark"},
      {k:"collage", t:"Collage"},
      {k:"grid", t:"Grid"},
      {k:"print", t:"Print/Export"},
      {k:"tmpl", t:"Templates"},
      {k:"hist", t:"Histogram"},
      {k:"meta", t:"Metadata"}
    ]
  }
};

/* ---------- STATE ---------- */
let activeTab = "manual";
let manualLevel = "basic";

/* ---------- HELPERS ---------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function iconSVG(key, coloredRotate=false){
  // Minimal icon set, rotate colored if requested
  switch(key){
    case "crop":    return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M6 2v4H2m16 0h4v16M6 22v-4h10"/></svg>';
    case "rotate":  return `<svg class="icon icon-rotate" viewBox="0 0 24 24" fill="none" stroke="currentColor">
       <path class="grad" stroke-width="2" d="M4 12a8 8 0 1 0 8-8v3"/><path stroke-width="2" d="M4 4v5h5"/>
     </svg>`;
    case "flip":    return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M12 4v16M4 12h16M4 6l4 4-4 4M20 6l-4 4 4 4"/></svg>';
    case "resize":  return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 20h4v-4H4zM16 8h4V4h-4zM10 14h4v-4h-4zM4 8h4V4H4zM16 20h4v-4h-4z"/></svg>';
    case "adjust":  return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="9" stroke-width="2"/><path stroke-width="2" d="M12 3a9 9 0 0 0 0 18V3z"/></svg>';
    case "auto":    return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 12h4l2-7 4 14 2-7h6"/></svg>';
    case "sharpen": return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M12 2l7 19H5z"/></svg>';
    case "clarity": return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7" stroke-width="2"/><rect x="14" y="14" width="7" height="7" stroke-width="2"/></svg>';
    case "wb":      return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="7" cy="12" r="3" stroke-width="2"/><path stroke-width="2" d="M12 6h8M12 12h8M12 18h8"/></svg>';
    case "redeye":  return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6S2 12 2 12z"/><circle cx="12" cy="12" r="3" stroke-width="2"/></svg>';
    case "vign":    return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="4" y="4" width="16" height="16" rx="4" stroke-width="2"/></svg>';
    case "grain":   return '<svg class="icon" viewBox="0 0 24 24" fill="currentColor"><circle cx="6" cy="7" r="1"/><circle cx="18" cy="8" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="8" cy="17" r="1"/><circle cx="17" cy="15" r="1"/></svg>';
    case "heal":    return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M7 7l10 10M12 2l10 10-10 10L2 12 12 2z"/></svg>';
    case "clone":   return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="7" width="13" height="13" rx="2" stroke-width="2"/><rect x="8" y="4" width="13" height="13" rx="2" stroke-width="2"/></svg>';
    case "dodge":   return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="4" stroke-width="2"/><path stroke-width="2" d="M12 2v2m0 16v2M2 12h2m16 0h2"/></svg>';
    case "noise":   return iconSVG("grain");
    case "balance": return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M12 3v18M4 7h16M7 7l3 6H4l3-6zm10 0l3 6h-6l3-6z"/></svg>';
    case "curve":   return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 20c8 0 8-12 16-12"/></svg>';
    case "levels":  return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 18h4M10 14h4M16 10h4"/></svg>';
    case "hsl":     return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="8" cy="12" r="3" stroke-width="2"/><circle cx="16" cy="12" r="3" stroke-width="2"/></svg>';
    case "lens":    return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="8" stroke-width="2"/><path stroke-width="2" d="M4 12h16"/></svg>';
    case "persp":   return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 7l9-4 9 4-9 4-9-4zm0 10l9 4 9-4"/></svg>';
    case "tilt":    return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="5" y="5" width="14" height="14" rx="3" stroke-width="2"/><path stroke-width="2" d="M5 15h14"/></svg>';
    case "split":   return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="4" y="4" width="16" height="16" rx="3" stroke-width="2"/><path stroke-width="2" d="M12 4v16"/></svg>';
    case "inpaint": case "facerep": case "superres": case "deblur": case "colorize": case "bgbuild":
    case "relight": case "style": case "hdrmerge": case "raw": case "matte": case "upscale":
      return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 21l18-18M7 7l3 3M14 14l3 3"/></svg>';
    case "bgremove": return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M5 5l14 14M9 5h10v10"/></svg>';
    case "bgreplace":return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 7h6v6H4zM14 11h6v6h-6zM10 10l4 4"/></svg>';
    case "bgblur":   return '<svg class="icon" viewBox="0 0 24 24" fill="currentColor" stroke="none"><circle cx="8" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="16" cy="12" r="2"/></svg>';
    case "bgradient":return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><defs/><linearGradient/><rect x="4" y="4" width="16" height="16" rx="3" stroke-width="2"/></svg>';
    case "bgsalid":  return iconSVG("bgsold");
    case "bgai":     return iconSVG("inpaint");
    case "tadd": case "tfont": case "tstyle": case "tshadow": case "tstroke": case "tcurve":
    case "tshape": case "twarp": case "tgrad": case "tmask":
      return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M4 6h16M10 6v12m4-12v12"/></svg>';
    case "frame": case "sticker": case "flare": case "watermark":
    case "collage": case "grid": case "print": case "tmpl": case "hist": case "meta":
      return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="5" y="5" width="14" height="14" stroke-width="2"/></svg>';
    default: return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="9" stroke-width="2"/></svg>';
  }
}

function makeTile(item){
  const el = document.createElement("button");
  el.className = "tile wrap";
  el.innerHTML = `${item.icon||iconSVG(item.k, item.iconColor)}<div class="tl">${item.t}</div>${item.pro?'<span class="gem" title="Premium"></span>':''}`;
  el.title = item.t + (item.pro?' — Premium':'');
  el.onclick = ()=> {
    document.getElementById("propText").textContent = `Dipilih: ${item.t}${item.pro?' (Premium)':''}`;
  };
  return el;
}

function renderManual(level){
  const box = document.createElement("div");
  // segmented tabs
  const seg = document.createElement("div");
  seg.className = "seg";
  TOOLS.manual.tabs.forEach(tab=>{
    const b = document.createElement("button");
    b.textContent = TOOLS.manual.label[tab];
    if (tab===level) b.classList.add("active");
    b.onclick = ()=>{ manualLevel = tab; mountSubpanel(); };
    seg.appendChild(b);
  });
  const grid = document.createElement("div");
  grid.className = "grid cols-4";
  (TOOLS.manual[level]||[]).forEach(it=> grid.appendChild(makeTile(it)));
  box.append(seg, document.createElement("div"));
  box.lastChild.appendChild(grid);
  return box;
}
function renderFilter(){
  const box = document.createElement("div");
  const g = document.createElement("div");
  g.className = "grid cols-4";
  TOOLS.filter.presets.forEach(p=> g.appendChild(makeTile({k:"preset",t:p})));
  box.appendChild(g);
  return box;
}
function renderSimple(groupKey){
  const box = document.createElement("div");
  const g = document.createElement("div");
  g.className = "grid cols-4";
  TOOLS[groupKey].items.forEach(it=> g.appendChild(makeTile(it)));
  box.appendChild(g);
  return box;
}

function mountSubpanel(){
  // desktop
  const desk = document.getElementById("subpanelDesk");
  desk.innerHTML = "";
  desk.appendChild(
    activeTab==="manual" ? renderManual(manualLevel)
    : activeTab==="filter" ? renderFilter()
    : activeTab==="bg"     ? renderSimple("bg")
    : activeTab==="text"   ? renderSimple("text")
    : renderSimple("more")
  );
  // mobile drawer
  const mob = document.getElementById("subpanelMobile");
  mob.innerHTML = desk.innerHTML; // copy simple
}

/* ---------- NAV BINDINGS ---------- */
// Desktop icons
$$('.sideL .tabIcon').forEach(b=>{
  b.addEventListener('click', ()=>{
    $$('.sideL .tabIcon').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    activeTab = b.dataset.tab;
    mountSubpanel();
  });
});
// Mobile pills
$$('.bottom .pill').forEach(b=>{
  b.addEventListener('click', ()=>{
    $$('.bottom .pill').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    activeTab = b.dataset.tab;
    mountSubpanel();
    // open drawer
    document.getElementById('drawer').classList.add('show');
  });
});
document.querySelector('.drag').addEventListener('click', ()=>$('#drawer').classList.remove('show'));

/* ---------- INIT UI ---------- */
(function init(){
  // set default active (Manual)
  const firstDesk = document.querySelector('.sideL .tabIcon[data-tab="manual"]');
  if (firstDesk) firstDesk.classList.add('active');
  const firstMob = document.querySelector('.bottom .pill[data-tab="manual"]');
  if (firstMob) firstMob.classList.add('active');
  mountSubpanel();
  // simple canvas sizing
  const cv = document.getElementById('cv');
  const board = document.getElementById('board');
  function fit(){ cv.width = board.clientWidth; cv.height = board.clientHeight; }
  window.addEventListener('resize', fit); fit();
})();

/* ---------- PLACEHOLDER ACTIONS ---------- */
document.getElementById('file').addEventListener('change', e=>{
  const ph = document.getElementById('ph');
  ph.innerHTML = '<div class="card"><b>Gambar dimuat (mock)</b><div class="muted">Ini hanya preview state.</div></div>';
});
document.getElementById('btnSave').addEventListener('click', ()=>{
  alert('Mock: simpan/export nanti diimplementasi.');
});
</script>
</body>
        </html>
